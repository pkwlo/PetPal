<!DOCTYPE html>
<html>

<head>
    <title>Community</title>
    <link rel="stylesheet" href="/css/style.css">
<script>
    function fetchUserInfo() {
            fetch('/profile/user-info')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        window.location.href = '/login';
                    } else {
                        document.getElementById('name').value = data.name;
                    }
                });
        }

    function fetchPosts() {
        fetch('/community/posts')
            .then(response => response.json())
            .then(data => {
                console.log('Fetched posts:', data); // <--- add this line
                const postsContainer = document.querySelector('.posts');
                postsContainer.innerHTML = '';

                data.forEach(post => {
                    const postElement = document.createElement('div');
                    postElement.classList.add('post');

                    let html = `
                        <div class="post-image">
                            <img src="${post.imageUrl}">
                            posted by ${post.name}
                        </div>
                    `;
                    if (post.comment) {
                        html += `<div class="post-comment">${post.comment}</div>`;
                    }
                    postElement.innerHTML = html;
                    postsContainer.appendChild(postElement);
                });
            })
            .catch(err => console.error('Error fetching posts:', err)); // <-- also important
    }

    // Call this when page loads
    window.onload = function () {
            fetchUserInfo();
            fetchPosts();
        };
</script>

</head>

<body>
    <!-- Navigation Bar -->
    <nav>
        <a href="/profile">Profile</a>
        <a href="/community">Community</a>
        <a href="/reminders">Reminders</a>
        <a href="/logout">Logout</a>
    </nav>
    <h1>Upload a Photo</h1>
    <div class="post-form-container">
        <form method="POST" action="/community/submit" enctype="multipart/form-data" class="reminder-form">    
            <div class="form-row">
                <label for="photo">Photo Upload:</label>
                <input type="file" name="photo" id="photo" accept="image/*" required>
            </div>
            <div class="form-row">
                <label for="comment">Comment:</label>
                <input type="text" name="comment" id="comment">
            </div>
            <input type="hidden" name="name" id="name">
            <button type="submit">Post to Community</button>
        </form>
    </div>
    <h1>Recent Community Posts</h1>
    <div class="posts">
        <!-- posts loading here -->
    </div>    
</body>

</html>